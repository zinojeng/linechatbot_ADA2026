# 📚 知識庫模式使用指南

## 🎯 功能概述

LINE Bot 現在支援兩種模式：

### 1️⃣ 📚 知識庫模式（Knowledge Base Mode）
- 使用共用的醫療知識庫（糖尿病照護標準 2025）
- 適合查詢專業醫療知識
- 所有使用者共享同一個知識庫
- **預設模式**

### 2️⃣ 📁 個人模式（Personal Mode）
- 使用您個人上傳的文件
- 每個使用者有獨立的文件庫
- 群組中所有成員共享群組文件庫
- 適合處理私人文件

---

## 🚀 快速開始

### 步驟 1：上傳知識庫文件

執行上傳腳本，將 `documents` 資料夾中的 .md 檔案上傳到 Gemini：

```bash
# 設定環境變數（如果還沒設定）
export GOOGLE_API_KEY='your_google_api_key_here'

# 執行上傳腳本
python upload_knowledge_base.py
```

### 步驟 2：部署 LINE Bot

確保 `.env` 檔案包含知識庫設定：

```bash
USE_KNOWLEDGE_BASE=true  # 預設啟用知識庫模式
```

### 步驟 3：開始使用

在 LINE 中與 Bot 對話！

---

## 💬 使用範例

### 查詢知識庫（預設模式）

```
👤 你: 糖尿病患者的 A1C 目標是多少？
🤖 Bot: 📚 根據 2025 年糖尿病照護標準，大多數成年糖尿病
       患者的 A1C 目標是 <7%。但需根據個人情況調整，
       包括：
       • 年齡
       • 糖尿病病程
       • 併發症風險
       • 低血糖風險
```

### 查看目前模式

```
👤 你: 模式
🤖 Bot: 🔍 目前模式：

       📚 知識庫模式
       使用共用醫療知識庫（糖尿病照護標準 2025）回答問題

       💡 切換模式請輸入：
       • 「切換知識庫模式」
       • 「切換個人模式」
```

### 切換到個人模式

```
👤 你: 切換個人模式
🤖 Bot: ✅ 已切換到 📁 個人模式
       使用您上傳的個人文件回答問題

       現在可以開始提問了！

👤 你: [上傳個人文件 report.pdf]
🤖 Bot: ✅ 檔案已成功上傳！
       檔案名稱：report.pdf

       現在您可以詢問我關於這個檔案的任何問題。

👤 你: 這份報告的重點是什麼？
🤖 Bot: 📁 這份報告的重點包括...
```

### 切換回知識庫模式

```
👤 你: 切換知識庫模式
🤖 Bot: ✅ 已切換到 📚 知識庫模式
       使用共用醫療知識庫（糖尿病照護標準 2025）回答問題

       現在可以開始提問了！
```

---

## 🎛️ 模式切換指令

### 查看目前模式
- `模式`
- `目前模式`
- `當前模式`
- `mode`
- `current mode`

### 切換到知識庫模式
- `切換知識庫模式`
- `使用知識庫`
- `知識庫模式`
- `knowledge mode`
- `switch to knowledge`

### 切換到個人模式
- `切換個人模式`
- `使用個人檔案`
- `個人模式`
- `personal mode`
- `switch to personal`

---

## 📊 模式比較

| 功能 | 📚 知識庫模式 | 📁 個人模式 |
|------|------------|-----------|
| 資料來源 | 共用醫療知識庫 | 個人上傳文件 |
| 適用情境 | 專業知識查詢 | 私人文件分析 |
| 文件範圍 | 糖尿病照護標準 2025（17份文件） | 使用者自行上傳 |
| 隔離性 | 所有使用者共享 | 每人獨立（群組共享） |
| 文件管理 | 無法刪除知識庫文件 | 可上傳、列出、刪除 |
| 回應標記 | 📚 | 📁 |

---

## 🔧 進階設定

### 修改預設模式

編輯 `.env` 檔案：

```bash
# 預設使用知識庫模式
USE_KNOWLEDGE_BASE=true

# 預設使用個人模式
USE_KNOWLEDGE_BASE=false
```

### 修改知識庫名稱

編輯 `main.py`：

```python
KNOWLEDGE_BASE_STORE_NAME = "chatbot_knowledge_base"  # 改成您的知識庫名稱
```

**注意**：修改後需要重新執行 `upload_knowledge_base.py` 並使用相同名稱。

### 自訂模式切換關鍵字

編輯 `main.py` 中的 `is_mode_switch_intent` 函數：

```python
# 知識庫模式關鍵字
knowledge_keywords = [
    '知識庫', '知識庫模式', '使用知識庫', '切換知識庫',
    '糖尿病', '醫療知識', '專業知識',
    'knowledge', 'knowledge base'
    # 在這裡新增您的關鍵字
]

# 個人模式關鍵字
personal_keywords = [
    '個人檔案', '個人模式', '我的檔案', '私人檔案',
    '切換個人', '使用個人',
    'personal', 'my files', 'personal mode'
    # 在這裡新增您的關鍵字
]
```

---

## 💡 使用技巧

### 1. 知識庫適合查詢什麼？

目前知識庫包含「美國糖尿病協會 2025 年糖尿病照護標準」，適合查詢：

- ✅ 糖尿病診斷標準
- ✅ A1C 目標值
- ✅ 血糖監測建議
- ✅ 營養管理
- ✅ 運動建議
- ✅ 藥物治療
- ✅ 併發症預防
- ✅ 特殊族群照護（孕婦、老年人等）

### 2. 什麼時候切換到個人模式？

當您需要：
- 📄 分析私人文件（報告、合約等）
- 📊 查詢公司內部文件
- 📋 處理會議記錄
- 📝 分析個人筆記

### 3. 模式會自動切換嗎？

不會。模式切換需要明確指令，切換後會一直保持該模式，直到您再次切換。

### 4. 群組中的模式設定

每個使用者在群組中有**獨立的模式設定**：
- 使用者 A 可以使用知識庫模式
- 使用者 B 可以同時使用個人模式
- 互不影響

但在個人模式下，群組成員**共享文件庫**。

---

## 🐛 常見問題

### Q: 切換到知識庫模式後，提示「還沒有上傳任何檔案」？

**A:** 請確認：
1. 已執行 `python upload_knowledge_base.py` 上傳知識庫
2. `main.py` 中的 `KNOWLEDGE_BASE_STORE_NAME` 與上傳腳本一致
3. 上傳成功且沒有錯誤訊息

### Q: 如何更新知識庫內容？

**A:**
1. 將新的 .md 檔案放入 `documents` 資料夾
2. 重新執行 `python upload_knowledge_base.py`
3. 重新部署 LINE Bot（或重啟服務）

### Q: 可以同時查詢知識庫和個人文件嗎？

**A:** 目前不支援。需要在兩種模式間切換。未來可以考慮實作「混合模式」。

### Q: 知識庫會佔用我的個人額度嗎？

**A:** 知識庫是共用的，所有使用者共享。不會重複計算每個使用者的額度。

### Q: 刪除個人文件會影響知識庫嗎？

**A:** 不會。知識庫是獨立的，個人文件操作不會影響知識庫。

---

## 📈 擴充知識庫

想要新增更多知識？

### 步驟 1：準備文件

將文件轉換為 Markdown (.md) 格式，放入 `documents` 資料夾。

### 步驟 2：上傳

```bash
python upload_knowledge_base.py
```

### 步驟 3：測試

切換到知識庫模式，測試查詢新內容。

---

## 🎉 完成！

現在您已經了解如何使用知識庫模式了！

有任何問題，請查看：
- [主要 README](README.md)
- [文件資料夾說明](documents/README.md)
- [上傳腳本](upload_knowledge_base.py)
